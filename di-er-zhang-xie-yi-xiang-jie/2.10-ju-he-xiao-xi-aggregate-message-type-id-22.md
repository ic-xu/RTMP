# 2.10、聚合消息 Aggregate Message （type ID = 22）

Aggregate Message（聚集信息，Message Type ID = 22）：多个 RTMP 子消息的集合。 集合消息由消息头和消息内容组成。 消息内容由子消息组成，子消息由消息头，消息数据，回放指针组成。

```java
                 +---------+-------------------------+
                 | Header  | Aggregate Message body  |
                 +---------+-------------------------+
                     The Aggregate Message format
    +--------+-------+---------+--------+-------+---------+ - - - -
    |Header 0|Message|Back     |Header 1|Message|Back     |
    |        |Data 0 |Pointer 0|        |Data 1 |Pointer 1|
    +--------+-------+---------+--------+-------+---------+ - - - -
                   The Aggregate Message body format
```

集合消息的消息流 ID 覆盖此消息内的子消息流的ID。 集合消息和第一个子消息的时间戳之间的偏移量，用来将子消息的时间戳处理为流的时间刻度。每个子消息的时间戳可以通过添加偏移量来处理为正常的流时间。第一个子消息的时间戳应该和集合消息的时间戳相同，因此偏移量应该为零。 方向指针包含了以前的消息（包含头信息）的大小。集合消息包含此字段，一是为了适配 FLV 文件格式，二是为了回放定位。

使用集合消息有如下几种优势：

* 块流在一个块内至多可以携带一条完整的消息。使用集合消息之后，不仅可以增加块大小，同时还减少了发送的块数量；
* 集合消息的子消息可以连续的存储在内存中。当系统调用网络发送数据时更高效。
